/*
 *  jquery-getit - v1.0.0
 *  Use this plugin to link terms to definitions in the GET-IT Glossary
 *  http://getitglossary.org
 *
 *  Made by Robin Layfield
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.options=a.extend({},g,c),this.options.linkTitle=this.options.linkTitle.replace("{{glossary}}",this.options.glossary),this._defaults=g,this._name=f,this.init()}var f="getit",g={glossary:"getitglossary.org",title:"Click to view the GET-IT Glossary definition of this term",linkTitle:"View the full definition at {{glossary}} &rarr;",notFound:"Definition not found. It may have been removed or updated. Please contact the site administrator.",titleNotFound:"Term not found"};a.extend(e.prototype,{init:function(){this.crawl(this.element,this.options)},crawl:function(b,c){a("cite").each(function(b){if(a(this).data("processed"))return!1;var e=a(this).data("term");d===e&&(e=a(this).text()),e.replace(/\s/g,"+"),a(this).addClass("getit-definition"),a(this).prop("title",c.title),a(this).data("getit-link",'<a href="http://'+c.glossary+"/term/"+e+'" target="_blank">'+c.linkTitle+"</a>"),a(this).data("tooltip",b),a.ajax({dataType:"json",url:"http://"+c.glossary+"/v1/terms/"+e,context:a(this)}).done(function(f){var g;f[0]===d?(g=c.notFound,e=c.titleNotFound,a(this).data("getitLink","")):g=f[0].definition;var h=/(\[)([\w\s,\'+-]*)(\|)([\w\s,\'+-]*)(\])/g,i=/(\[)([\w\s,\']*)(\])/g,j="<strong>$2</strong>";g=g.replace(h,j),g=g.replace(i,j);var k=a('<div class="getit-tooltip" data-tooltip="'+b+'"><h2>'+e+"</h2><p>"+g+"</p><p>"+a(this).data("getitLink")+'</p><div class="getit-arrow"></div></div>').appendTo("body"),l=a(this).offset();k.css({top:l.top-k.outerHeight()-13,left:l.left-k.width()/2}),f[0]===d&&k.addClass("getit-notfound")}),a(this).data("processed",!0),a(this).on("click",function(){var b=a("div[data-tooltip="+a(this).data("tooltip")+"]"),c=a.now().toString().substr(5),d=a(this).offset();d.left-b.width()/2<=0&&(d.left=b.width()/2),b.css({top:d.top-b.outerHeight()-13,left:d.left-b.width()/2,zIndex:c}),b.addClass("active")})})}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document),function(a){a(document).ready(function(){a(document).keyup(function(b){27===b.keyCode&&a(".getit-tooltip").each(function(){if(a(this).hasClass("active")){a(this).addClass("out");var b=a(this);setTimeout(function(){b.removeClass("active").removeClass("out")},300)}})}),a(document).click(function(b){"CITE"!==b.target.nodeName&&a(".getit-tooltip").each(function(){if(a(this).hasClass("active")){a(this).addClass("out");var b=a(this);setTimeout(function(){b.removeClass("active").removeClass("out")},300)}})})})}(jQuery);