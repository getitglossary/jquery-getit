/*
 *  jquery-getit - v1.0.0
 *  Use this plugin to link terms to definitions in the GET-IT Glossary
 *  http://getitglossary.org
 *
 *  Made by Robin Layfield
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.options=a.extend({},g,c),this.options.linkTitle=this.options.linkTitle.replace("{{glossary}}",this.options.glossary),this._defaults=g,this._name=f,this.init()}var f="getit",g={glossary:"getitglossary.org",title:"Click to view the GET-IT Glossary definition of this term",linkTitle:"View the full definition at {{glossary}} &rarr;",hideNotFound:!1,notFound:"Definition not found. It may have been removed or updated. Please contact the site administrator.",titleNotFound:"Term not found"};a.extend(e.prototype,{init:function(){this.crawl(this.element,this.options)},crawl:function(b,c){a("cite").each(function(b){if(a(this).data("processed"))return!1;var e=a(this).data("term");d===e&&(e=a(this).text()),e.replace(/\s/g,"+"),a(this).addClass("getit-definition"),a(this).prop("title",c.title),a(this).data("getit-link",'<a href="http://'+c.glossary+"/term/"+e+'" target="_blank">'+c.linkTitle+"</a>"),a(this).data("tooltip",b),a.ajax({dataType:"json",url:"http://"+c.glossary+"/v1/terms/"+e,context:a(this)}).done(function(f){var g,h=!1;f[0]===d?(g=c.notFound,e=c.titleNotFound,h=!0,a(this).data("getitLink",""),c.hideNotFound&&a(this).replaceWith(a(this).text())):g=f[0].definition;var i=/(\[)([\w\s,\'+-]*)(\|)([\w\s,\'+-]*)(\])/g,j=/(\[)([\w\s,\']*)(\])/g,k="<strong>$2</strong>";if(g=g.replace(i,k),g=g.replace(j,k),!h||!c.hideNotFound){var l=a('<div class="getit-tooltip" data-tooltip="'+b+'"><h2>'+e+"</h2><p>"+g+"</p><p>"+a(this).data("getitLink")+'</p><div class="getit-arrow"></div></div>').appendTo("body"),m=a(this).offset();l.css({top:m.top-l.outerHeight()-13,left:m.left-l.width()/2}),f[0]===d&&l.addClass("getit-notfound")}}),a(this).data("processed",!0),a(this).on("click",function(){var b=a("div[data-tooltip="+a(this).data("tooltip")+"]"),d=a.now().toString().substr(5),f=a(this).offset();f.left-b.width()/2<=0&&(f.left=b.width()/2),b.css({top:f.top-b.outerHeight()-13,left:f.left-b.width()/2,zIndex:d}),b.addClass("active"),a.get({url:"http://"+c.glossary+"/v1/hit/"+e})})})}}),a.fn[f]=function(b){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document),function(a){a(document).ready(function(){a(document).keyup(function(b){27===b.keyCode&&a(".getit-tooltip").each(function(){if(a(this).hasClass("active")){a(this).addClass("out");var b=a(this);setTimeout(function(){b.removeClass("active").removeClass("out")},300)}})}),a(document).click(function(b){"CITE"!==b.target.nodeName&&a(".getit-tooltip").each(function(){if(a(this).hasClass("active")){a(this).addClass("out");var b=a(this);setTimeout(function(){b.removeClass("active").removeClass("out")},300)}})})})}(jQuery);